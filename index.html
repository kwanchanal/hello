<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Helloo — Sa • Waddee • Ka</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div id="canvas">
    <div id="stage" aria-label="playground"></div>
  </div>

  <!-- hint pill -->
  <div class="hint" role="note">drag + zoom + resize + to play with me!</div>

  <!-- main interaction -->
  <script src="./script.js"></script>

  <!-- entrance animation -->
  <script>
    (function () {
      const SELECTORS = [
        '#stage > *',
        '#stage img',
        '#stage svg'
      ];
      const STAGGER  = 120;   // หน่วงทีละชิ้น (ms)
      const DURATION = 900;   // ระยะเวลา fade-in (ms)
      const EASING   = 'cubic-bezier(.2,.75,.25,1.2)';

      function animateNodes(nodes){
        nodes.forEach((el, i) => {
          // กัน animation เก่า
          el.getAnimations?.().forEach(a => a.cancel());

          const anim = el.animate(
            [
              { opacity: 0, transform: 'translateY(40px) scale(0.9)', filter: 'blur(3px)' },
              { opacity: 1, transform: 'translateY(0) scale(1)',      filter: 'blur(0)' }
            ],
            {
              duration: DURATION,
              delay: i * STAGGER,
              easing: EASING,
              fill: 'forwards' // คงอยู่ที่ state สุดท้าย ไม่กระพริบซ้ำ
            }
          );

          // safety กันบาง browser ค้าง frame แปลก
          anim.addEventListener('finish', () => {
            try { anim.commitStyles(); anim.cancel(); } catch {}
          });
        });
      }

      // เล่น animation ครั้งเดียวตอน load
      window.addEventListener('load', () => {
        const els = Array.from(document.querySelectorAll(SELECTORS.join(',')));
        if (els.length) animateNodes(els);

        // เมื่อ user เริ่ม interact ให้ยกเลิก animation ของ element นั้น
        document.addEventListener('pointerdown', e => {
          const el = e.target.closest('#stage > *');
          if (el) el.getAnimations?.().forEach(a => a.cancel());
        }, { capture: true });
      }, { once: true });
    })();
  </script>
</body>
</html>
