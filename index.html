<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Helloo — Sa • Waddee • Ka</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div id="canvas">
    <div id="stage" aria-label="playground"></div>
  </div>

  <!-- hint pill -->
  <div class="hint" role="note">drag + zoom + resize + to play with me!</div>

  <!-- main interaction -->
  <script src="./script.js"></script>

  <!-- Entrance animation: cinematic, once, no flicker -->
  <script>
    (function () {
      // เราจะ animate เฉพาะที่มีคลาส .entering (ที่ script.js ใส่มาให้)
      const SELECTOR = '#stage > .entering, #stage img.entering, #stage svg.entering';

      // โทนเนิบ ๆ cinematic
      const STAGGER  = 160;   // หน่วงทีละชิ้น (ms)
      const DURATION = 1400;  // ระยะเวลา (ms)
      const EASING   = 'cubic-bezier(.16,.84,.16,1)';

      function animateOnce(nodes){
        nodes.forEach((el, i) => {
          // กันซ้ำ
          el.getAnimations?.().forEach(a => a.cancel());

          const anim = el.animate(
            [
              // ค่าจุดเริ่มตรงกับ .entering ใน CSS
              { opacity: 0, transform: 'translateY(48px) scale(0.92)' },
              { opacity: 1, transform: 'translateY(0) scale(1)' }
            ],
            {
              duration: DURATION,
              delay: i * STAGGER,
              easing: EASING,
              fill: 'forwards',
              composite: 'replace'
            }
          );

          anim.addEventListener('finish', () => {
            try {
              anim.commitStyles();   // คงค่าปลายทาง
              anim.cancel();         // แล้วล้าง animation timeline
            } catch {}
            el.classList.remove('entering'); // เอาคลาสซ่อนออก → ไม่มีแว็บ/กระพริบ
          });
        });
      }

      window.addEventListener('load', () => {
        const nodes = Array.from(document.querySelectorAll(SELECTOR));
        if (nodes.length) animateOnce(nodes);

        // ถ้า user แตะ/ลากก่อนจบ ให้ยกเลิก animation ของ element นั้น
        document.addEventListener('pointerdown', (e) => {
          const el = e.target.closest('#stage > *');
          if (!el) return;
          el.getAnimations?.().forEach(a => a.cancel());
          el.classList.remove('entering');
          // ตั้งค่าให้เป็นปลายทางทันที เพื่อไม่ชักกระพริบ
          el.style.opacity = '1';
          el.style.transform = 'translateY(0) scale(1)';
        }, { capture: true });
      }, { once: true });
    })();
  </script>
</body>
</html>
